对于网络的理解

生活中我们常常会接触到网络，比如互联网、局域网或蜂窝数据网，但是看似我们对网络好像有一些了解，其实很可能我们之前对于网络的一些理解是浅薄的、片面的、通俗的。

如果在我没有学习网络之前，你问我网络是什么，我肯定很难表达出来，就是那种大概知道它是什么东西但又不会说的半吊子的感觉。网络可以让我们远距离交流，可以游玩、下载别人放在网络上的游戏，还可以让我们在线学习，那么网络是什么，我也很难说的清楚。但其实网络没那么神秘，网络就是一个可以让不同设备进行通信和数据传输的东西，不管是大的互联网，还是小的互联网，都是这个定义。你想想，上面的例子是不是都能对的上，网络就是这么简单，一点就懂，一说就通。

网络是什么我们知道了，那网络是怎么实现它的功能——也就是让不同设备进行通信和数据传输的呢？听我来慢慢道来。

为了简化网络设计、实现、维护和管理，人们将网络的实现过程分为几个层级。分层的方法有好多种，有TCP/IP模型，OSI七层模型，还有一种常用的五层模型。事实上，不管将网络分为几层，都不会改变网络本身，而且不同的分层法也只是理解角度的不同，并不会增添或者减少网络的功能。下面我就以五层模型来讲解网络的实现过程。

五层模型从底层到顶层分别是物理层，数据链路层，网络层，传输层，应用层，我将从最底层的物理层开始讲。

![640?wx_fmt=png](https://img-blog.csdnimg.cn/img_convert/1174ffe87ef782cf27a5a28121acbe1f.png)

让我们从头开始想，如果设备之间要进行通信和数据传输，肯定要想办法让它们彼此之间可以发送、接收信号。巧妇难为无米之炊，再高超的网络技术，也需要有这个基础条件才能施展，而让设备连接的方法就在物理层中。设备连接有很多种方法，有传统的光纤、电缆、网线连接，也有新型的WIFI（无线局域网技术），蜂窝网络，蓝牙等技术。不管这些技术有多么花哨新颖，它们都只是为了方便设备之间的连接，也就是物理层的连接。

设备之间连接后，可以在彼此之间传输、接收信号。这样简单的连接，就构成了一个局域网。在有线网络中，它们传输的的是电信号，在无线网络中，它们传递的是电磁波，这些都是计算机无法直接理解的信息，所以就需要有一套规则使计算机能够读懂这些信息。

![640?wx_fmt=png](https://img-blog.csdnimg.cn/img_convert/f23707d8cdfd7c1fefa1d6cbff86dbd1.png)

在局域网中，有一个针对局域网的以太网协议可以解决这个问题。以太网协议规定，一组信号构成一个数据包，我们把这个数据包称之为帧。每一个帧由表头(Head)和数据(Data)两部分组成。

![640?wx_fmt=png](https://img-blog.csdnimg.cn/img_convert/766c31816a15cecb2f95aa5bbec8b69c.png)

帧的表头部分是一些说明数据，例如发送者，接收者等信息，数据部分则是需要传输的数据。

帧的大小一般为64-1518个字节，如果需要传输的数据很大，就要将这些数据分为几个帧去传输。帧的表头大小是固定的18个字节，这是因为计算机需要知道在哪个位置区分这些信号的表头和数据。

如果只是用一根网线将两个设备连接起来，我们只需要考虑数据怎么传输、接收，但是在正常的局域网中，我们常常面临的是一对多、多对一甚至多对多的情况，那么此时我们该如何精确地找到我们想传输的对象呢？于是，MAC地址出现了。

连入网络的每一个计算机都会有网卡，每一个网卡都有它唯一的地址，即MAC地址，MAC地址由6个字节构成，在网卡生产时就被唯一标识了，就像我们的身份证号码。计算机之间的数据传输，就是通过MAC地址来定位的。

那么两个设备怎么知道彼此的MAC地址呢？ARP协议可以解决这个问题，但是APR协议会涉及到网络层的IP地址，所以我们回过头再来讲，现在只需要记住ARP协议可以查找到MAC地址。

在找到目标设备的MAC地址后，我们怎么才能根据MAC地址定位到目标设备的端口呢，这时就要用到交换机了，交换机可以根据目标设备的MAC地址与它的MAC表找到对应的端口。然后就可以进行数据传输，同一个子网中，有三种数据传输方式，分别是单播、多播和广播。如果一个设备想给另一个设备传输数据，最好使用单播；如果想给好几个设备传输数据，最好使用多播，如果想给同一网络中所有设备都传输数据，最好使用广播。

上面我们有说到子网这个关键词，实际上我们所处的网络，是由无数个子网络构成的。单播、多播和广播的时候，也只有同一个子网里面的计算机能够收到。这是因为如果要把所有计算机放入同一个网络中所需的工作量是巨大的，所以我们要把网络分级为各个子网，例如互联网->广域网->城域网->局域网->个人区域网，单播、多播和广播的时候，只有同一个子网中的设备可以收到。网络与其他网络之间的通信是通过网关进行的，且只能与父网和子网通信，生活中最常见的网关就是路由器，连接了局域网和广域网。

上面我们所说的设备之间的数据传输，是只能在同一子网中的，那么如何判断MAC地址所在的子网呢？又有一个新概念叫做IP地址。如果把MAC地址比作每个设备的身份证的话，那么IP地址就是这些设备在不同网络中的个人帐号，身份证只能有一个，但是个人帐号可以有好多个，在微信你可以有一个微信帐号用来找到你，在QQ你也可以有个QQ帐号用来找到你，在不同的网络中有不同的IP地址也是同样的道理。

IP地址由IP协议定义，IP协议有两个版本一个是IPV4，一个是IPV6。IPV4是最常用的经典版本，IPV6则是新技术，所以我们主要学习IPV4。IP地址由32位的二进制数组成，我们一般把它写成四段的十进制表示，地址范围为0.0.0.0~255.255.255.255。

IP地址分为网络部分与主机部分，网络部分是为了区分所在子网，主机部分是为了区分同一子网中的设备，如果两个设备的网络部分相同，则说明这两个设备在同一子网中。网络部分与主机部分的多少不是固定的， 与网络规模和层级、网络设计和分配需求有关，大型网络需要更多的主机地址，因此网络部分占的位数少，主机部分占的位数多。小型网络需要更少的主机地址，因此网络部分占的位数多，主机部分占的位数少。那我们怎么知道具体的每个IP地址的网络部分和主机部分的位数呢？其实每个IP地址都有配套的子网掩码，子网掩码和IP地址一样也是 32 位二进制数，不过它的网络部分规定全部为 1，主机部分规定全部为 0，这样将IP地址与它的子网掩码做与运算，IP地址的主机部分就会变成0，这样就可以知道每个IP地址的网络部分和主机部分的位数。

前面我们提到了用来查找MAC地址的ARP协议与IP地址有关，现在来讲一下ARP协议。ARP协议是通过广播的形式给同一个子网中的每台电脑发送一个数据包(当然，这个数据包会包含接收方的IP地址)。对方收到这个数据包之后，会取出IP地址与自身的对比，如果相同，则把自己的MAC地址回复给对方，否则就丢弃这个数据包。这样，计算机A就能知道计算机B的MAC地址了。

那我们是如何知道目标计算机的IP地址的呢？当然是计算机的操作者来进行输入，当我们想要访问某个网站的时候，我们可以输入IP来进行访问，但是我相信绝大多数人是输入一个网址域名的，例如访问百度是输入 www.baidu.com 这个域名。其实当我们输入这个域名时，会有一个叫做DNS服务器的家伙来帮我们解析这个域名，然后返回这个域名对应的IP给我们。

通过物理层、数据链路层以及网络层的互相帮助，我们已经把数据成功从计算机A传送到计算机B了，可是，计算机B里面有各种各样的应用程序，计算机该如何知道这些数据是给谁的呢？

这个时候，端口(Port)这个家伙就上场了，也就是说，我们在从计算机A传数据给计算表B的时候，还得指定一个端口，以供特定的应用程序来接受处理。

也就是说，传输层的功能就是建立端口到端口的通信。相比网络层的功能是建立主机到主机的通信。

也就是说，只有有了IP和端口号，我们才能进行准确的通信。这个时候可能有人会说，我输入IP地址的时候并没有指定一个端口啊。其实呢，对于有些传输协议，已经有设定了一些默认端口了。例如http的传输默认端口是80，这些端口信息也会包含在数据包里的。

传输层最常见的两大协议是 TCP 协议和 UDP 协议，其中 TCP 协议与 UDP 最大的不同就是 TCP 提供可靠的传输，而 UDP 提供的是不可靠传输。

TCP